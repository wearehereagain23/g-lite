<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <!-- Put this viewport near the top of <head> -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no">


    <style>
        html,
        body {
            -webkit-text-size-adjust: 100%;
            text-size-adjust: 100%;
            touch-action: manipulation;
            /* stop double-tap zoom */
        }

        input,
        textarea,
        select,
        button {
            font-size: 16px !important;
            /* stop iOS auto-zoom on focus */
        }
    </style>
    <script>
        // Disable pinch zoom
        document.addEventListener('gesturestart', e => e.preventDefault(), { passive: false });

        // Disable double-tap zoom
        let lastTouchEnd = 0;
        document.addEventListener('touchend', e => {
            const now = Date.now();
            if (now - lastTouchEnd <= 300) {
                e.preventDefault();
            }
            lastTouchEnd = now;
        }, { passive: false });

        // Prevent pinch zoom on multi-touch
        document.addEventListener('touchmove', e => {
            if (e.touches.length > 1) e.preventDefault();
        }, { passive: false });
    </script>
</head>

<body>
    <h2>Zoom prevention test</h2>
    <p>Try pinch / double-tap / focus an input</p>
    <input placeholder="type here" />
    <br><br>
    <textarea placeholder="textarea"></textarea>

    <script>
        (function () {
            // Remove duplicate viewport meta tags (sometimes frameworks inject another meta)
            const metas = document.querySelectorAll('meta[name="viewport"]');
            if (metas.length > 1) {
                for (let i = 1; i < metas.length; i++) metas[i].remove();
            }

            // Ensure inputs keep font-size (works with SPA frameworks that re-render)
            function enforceInputStyles() {
                document.querySelectorAll('input, textarea, select, button').forEach(el => {
                    el.style.fontSize = '16px';
                    el.style.lineHeight = '1.2';
                    // vendor property fallback:
                    try { el.style.webkitTextSizeAdjust = '100%'; } catch (e) { }
                });
            }
            enforceInputStyles();

            // NON-PASSIVE touchstart to allow preventDefault() (important!)
            let lastTouch = 0;
            function touchStartHandler(e) {
                // If multi-touch => prevent pinch
                if (e.touches && e.touches.length > 1) {
                    e.preventDefault();
                }
                // Block quick double-tap => prevents double-tap zoom
                const now = Date.now();
                if (now - lastTouch <= 300) {
                    e.preventDefault();
                }
                lastTouch = now;
            }
            document.addEventListener('touchstart', touchStartHandler, { passive: false });

            // Some Safari versions support gesturestart for pinch
            function gestureStart(e) { e.preventDefault(); }
            document.addEventListener('gesturestart', gestureStart, { passive: false });

            // Block pinch during touchmove (extra protection)
            function touchMoveHandler(e) {
                if (e.touches && e.touches.length > 1) e.preventDefault();
            }
            document.addEventListener('touchmove', touchMoveHandler, { passive: false });

            // Try to block Ctrl/Cmd + wheel (desktop zoom)
            function wheelHandler(e) {
                if (e.ctrlKey || e.metaKey) {
                    e.preventDefault();
                }
            }
            document.addEventListener('wheel', wheelHandler, { passive: false });

            // Block Ctrl/Cmd + +/- or 0 key zoom shortcuts
            function keydownHandler(e) {
                if ((e.ctrlKey || e.metaKey) && (e.key === '+' || e.key === '-' || e.key === '=' || e.key === '0')) {
                    e.preventDefault();
                    e.stopImmediatePropagation();
                }
            }
            document.addEventListener('keydown', keydownHandler, true);

            // Re-apply when DOM changes (e.g. frameworks)
            const mo = new MutationObserver(enforceInputStyles);
            mo.observe(document.documentElement, { subtree: true, childList: true });

            // Cleanup if needed
            window.addEventListener('beforeunload', function () {
                document.removeEventListener('touchstart', touchStartHandler);
                document.removeEventListener('gesturestart', gestureStart);
                document.removeEventListener('touchmove', touchMoveHandler);
                document.removeEventListener('wheel', wheelHandler);
                document.removeEventListener('keydown', keydownHandler, true);
                mo.disconnect();
            });
        })();
    </script>
</body>

</html>